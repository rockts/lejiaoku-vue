# Cloudflare Pages éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°†ä¹æ•™åº“å‰ç«¯é¡¹ç›®éƒ¨ç½²åˆ° Cloudflare Pagesã€‚

## ğŸ“‹ å‰ç½®å‡†å¤‡

1. **Cloudflare è´¦æˆ·**ï¼šå¦‚æœæ²¡æœ‰ï¼Œè¯·è®¿é—® [cloudflare.com](https://www.cloudflare.com) æ³¨å†Œ
2. **GitHub ä»“åº“**ï¼šç¡®ä¿ä»£ç å·²æ¨é€åˆ° GitHub
3. **åç«¯ API åœ°å€**ï¼šå‡†å¤‡å¥½ç”Ÿäº§ç¯å¢ƒçš„åç«¯ API åœ°å€

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ç¯å¢ƒå˜é‡

1. åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.production` æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ° gitï¼‰ï¼š
   ```bash
   cp .env.production.example .env.production
   ```

2. ç¼–è¾‘ `.env.production`ï¼Œå¡«å…¥ä½ çš„ç”Ÿäº§ç¯å¢ƒ API åœ°å€ï¼š
   ```env
   VUE_APP_API_BASE_URL=https://your-backend-api-domain.com
   VUE_APP_NAME=ä¹æ•™åº“
   ```

### ç¬¬äºŒæ­¥ï¼šæœ¬åœ°æµ‹è¯•æ„å»º

åœ¨éƒ¨ç½²å‰ï¼Œå…ˆç¡®ä¿é¡¹ç›®å¯ä»¥æ­£å¸¸æ„å»ºï¼š

```bash
# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
yarn install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
yarn build
```

æ„å»ºæˆåŠŸåï¼Œä¼šåœ¨ `dist/` ç›®å½•ç”Ÿæˆé™æ€æ–‡ä»¶ã€‚

### ç¬¬ä¸‰æ­¥ï¼šæ¨é€åˆ° GitHub

ç¡®ä¿æ‰€æœ‰ä»£ç å·²æäº¤å¹¶æ¨é€åˆ° GitHubï¼š

```bash
git add .
git commit -m "å‡†å¤‡éƒ¨ç½²åˆ° Cloudflare Pages"
git push origin main  # æˆ–ä½ çš„ä¸»åˆ†æ”¯
```

### ç¬¬å››æ­¥ï¼šåœ¨ Cloudflare Pages åˆ›å»ºé¡¹ç›®

1. **ç™»å½• Cloudflare Dashboard**
   - è®¿é—® [dash.cloudflare.com](https://dash.cloudflare.com)
   - ç™»å½•ä½ çš„è´¦æˆ·

2. **è¿›å…¥ Pages**
   - åœ¨å·¦ä¾§èœå•æ‰¾åˆ° **"Workers & Pages"**
   - ç‚¹å‡» **"Create application"**
   - é€‰æ‹© **"Pages"** â†’ **"Connect to Git"**

3. **è¿æ¥ GitHub ä»“åº“**
   - é€‰æ‹© **"GitHub"** ä½œä¸º Git æä¾›å•†
   - æˆæƒ Cloudflare è®¿é—®ä½ çš„ GitHub è´¦æˆ·ï¼ˆå¦‚æœè¿˜æ²¡æˆæƒï¼‰
   - é€‰æ‹©ä»“åº“ï¼š`rockts/lejiaoku-vue`ï¼ˆæˆ–ä½ çš„ä»“åº“åï¼‰
   - é€‰æ‹©åˆ†æ”¯ï¼š`main`ï¼ˆæˆ– `dev`ï¼Œæ ¹æ®ä½ çš„éœ€æ±‚ï¼‰

### ç¬¬äº”æ­¥ï¼šé…ç½®æ„å»ºè®¾ç½®

åœ¨ Cloudflare Pages çš„æ„å»ºé…ç½®é¡µé¢ï¼Œå¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

#### æ„å»ºé…ç½®

- **Framework preset**: `Vue.js`ï¼ˆæˆ–é€‰æ‹© `None`ï¼‰
- **Build command**: `yarn build`
- **Build output directory**: `dist`
- **Root directory**: `/`ï¼ˆç•™ç©ºæˆ–å¡«å†™ `/`ï¼‰

#### ç¯å¢ƒå˜é‡

ç‚¹å‡» **"Environment variables"**ï¼Œæ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `VUE_APP_API_BASE_URL` | `https://your-backend-api-domain.com` | ä½ çš„åç«¯ API åœ°å€ |
| `VUE_APP_NAME` | `ä¹æ•™åº“` | åº”ç”¨åç§°ï¼ˆå¯é€‰ï¼‰ |
| `NODE_VERSION` | `16` æˆ– `18` | Node.js ç‰ˆæœ¬ï¼ˆå»ºè®® 16 æˆ– 18ï¼‰ |

**é‡è¦æç¤º**ï¼š
- å°† `https://your-backend-api-domain.com` æ›¿æ¢ä¸ºä½ çš„å®é™…åç«¯ API åœ°å€
- ç¡®ä¿åç«¯ API å·²é…ç½® CORSï¼Œå…è®¸ Cloudflare Pages çš„åŸŸåè®¿é—®

### ç¬¬å…­æ­¥ï¼šå¼€å§‹éƒ¨ç½²

1. ç‚¹å‡» **"Save and Deploy"**
2. Cloudflare ä¼šè‡ªåŠ¨å¼€å§‹æ„å»ºå’Œéƒ¨ç½²
3. æ„å»ºè¿‡ç¨‹å¯èƒ½éœ€è¦ 2-5 åˆ†é’Ÿ
4. æ„å»ºå®Œæˆåï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªé¢„è§ˆ URLï¼Œä¾‹å¦‚ï¼š`https://your-project.pages.dev`

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

1. åœ¨ Cloudflare Pages é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡» **"Custom domains"**
2. ç‚¹å‡» **"Set up a custom domain"**
3. è¾“å…¥ä½ çš„åŸŸåï¼ˆä¾‹å¦‚ï¼š`www.lejiaoku.com`ï¼‰
4. æŒ‰ç…§æç¤ºé…ç½® DNS è®°å½•
5. Cloudflare ä¼šè‡ªåŠ¨é…ç½® SSL è¯ä¹¦

### ç¬¬å…«æ­¥ï¼šé…ç½®é‡å®šå‘è§„åˆ™ï¼ˆé‡è¦ï¼‰

ç”±äº Vue Router ä½¿ç”¨ History æ¨¡å¼ï¼Œéœ€è¦é…ç½®é‡å®šå‘è§„åˆ™ï¼Œç¡®ä¿æ‰€æœ‰è·¯ç”±éƒ½è¿”å› `index.html`ã€‚

1. åœ¨ Cloudflare Pages é¡¹ç›®é¡µé¢ï¼Œè¿›å…¥ **"Functions"** â†’ **"Redirects"**
2. åˆ›å»º `_redirects` æ–‡ä»¶ï¼ˆæˆ–ä½¿ç”¨ Functionsï¼‰ï¼š

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `_redirects` æ–‡ä»¶**

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `public/_redirects` æ–‡ä»¶ï¼š

```
/*    /index.html   200
```

ç„¶åæäº¤å¹¶æ¨é€ï¼š

```bash
git add public/_redirects
git commit -m "æ·»åŠ  Cloudflare Pages é‡å®šå‘è§„åˆ™"
git push
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨ Cloudflare Functions**

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `functions/_redirects.ts`ï¼š

```typescript
export async function onRequest(context: EventContext) {
  return new Response(null, {
    status: 301,
    headers: {
      Location: '/index.html'
    }
  });
}
```

### ç¬¬ä¹æ­¥ï¼šéªŒè¯éƒ¨ç½²

1. è®¿é—®ä½ çš„ Cloudflare Pages URL
2. æµ‹è¯•ä¸»è¦åŠŸèƒ½ï¼š
   - é¦–é¡µåŠ è½½
   - è·¯ç”±å¯¼èˆªï¼ˆåˆ·æ–°é¡µé¢ä¸åº” 404ï¼‰
   - API è¯·æ±‚ï¼ˆæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS é”™è¯¯ï¼‰
   - ç™»å½•/æ³¨å†ŒåŠŸèƒ½
   - èµ„æºä¸Šä¼ åŠŸèƒ½

## ğŸ”§ å¸¸è§é—®é¢˜

### 1. æ„å»ºå¤±è´¥

**é—®é¢˜**ï¼šæ„å»ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `package.json` ä¸­çš„æ„å»ºè„šæœ¬
- ç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½å·²æ­£ç¡®å®‰è£…
- æŸ¥çœ‹ Cloudflare æ„å»ºæ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ç¡®ä¿ Node.js ç‰ˆæœ¬å…¼å®¹ï¼ˆå»ºè®®ä½¿ç”¨ 16 æˆ– 18ï¼‰

### 2. è·¯ç”± 404 é”™è¯¯

**é—®é¢˜**ï¼šç›´æ¥è®¿é—®è·¯ç”±ï¼ˆå¦‚ `/resources/123`ï¼‰è¿”å› 404

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿å·²é…ç½® `_redirects` æ–‡ä»¶ï¼ˆè§ç¬¬å…«æ­¥ï¼‰
- æ£€æŸ¥ `vue.config.js` ä¸­çš„ `publicPath` é…ç½®

### 3. API è¯·æ±‚å¤±è´¥ï¼ˆCORS é”™è¯¯ï¼‰

**é—®é¢˜**ï¼šæµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º CORS é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨åç«¯é…ç½® CORSï¼Œå…è®¸ Cloudflare Pages åŸŸåè®¿é—®
- æ£€æŸ¥ `VUE_APP_API_BASE_URL` ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®

### 4. ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

**é—®é¢˜**ï¼šæ„å»ºåç¯å¢ƒå˜é‡æ²¡æœ‰ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ç¯å¢ƒå˜é‡åç§°ä»¥ `VUE_APP_` å¼€å¤´
- é‡æ–°æ„å»ºé¡¹ç›®ï¼ˆç¯å¢ƒå˜é‡åœ¨æ„å»ºæ—¶æ³¨å…¥ï¼‰
- æ£€æŸ¥ Cloudflare Pages çš„ç¯å¢ƒå˜é‡é…ç½®

### 5. é™æ€èµ„æºåŠ è½½å¤±è´¥

**é—®é¢˜**ï¼šå›¾ç‰‡ã€CSSã€JS æ–‡ä»¶æ— æ³•åŠ è½½

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `vue.config.js` ä¸­çš„ `publicPath` é…ç½®
- ç¡®ä¿é™æ€èµ„æºè·¯å¾„æ­£ç¡®
- æ£€æŸ¥ Cloudflare Pages çš„æ„å»ºè¾“å‡ºç›®å½•æ˜¯å¦ä¸º `dist`

## ğŸ“ åç»­ç»´æŠ¤

### è‡ªåŠ¨éƒ¨ç½²

Cloudflare Pages å·²é…ç½®è‡ªåŠ¨éƒ¨ç½²ï¼š
- æ¯æ¬¡æ¨é€åˆ° `main` åˆ†æ”¯ä¼šè‡ªåŠ¨è§¦å‘æ„å»ºå’Œéƒ¨ç½²
- å¯ä»¥åœ¨ Cloudflare Dashboard æŸ¥çœ‹éƒ¨ç½²å†å²

### é¢„è§ˆéƒ¨ç½²

- æ¨é€åˆ°å…¶ä»–åˆ†æ”¯ä¼šåˆ›å»ºé¢„è§ˆéƒ¨ç½²
- æ¯ä¸ª Pull Request ä¼šè‡ªåŠ¨åˆ›å»ºé¢„è§ˆ URL

### å›æ»š

å¦‚æœæ–°éƒ¨ç½²æœ‰é—®é¢˜ï¼Œå¯ä»¥åœ¨ Cloudflare Pages çš„éƒ¨ç½²å†å²ä¸­å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚

## ğŸ‰ å®Œæˆï¼

éƒ¨ç½²å®Œæˆåï¼Œä½ çš„åº”ç”¨å°±å¯ä»¥é€šè¿‡ Cloudflare Pages çš„ URL è®¿é—®äº†ï¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ Cloudflare Pages çš„æ–‡æ¡£ï¼šhttps://developers.cloudflare.com/pages/

