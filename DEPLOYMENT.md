# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸŒ¿ åˆ†æ”¯ç­–ç•¥

**é‡è¦ï¼š** æœ¬é¡¹ç›®é‡‡ç”¨ä»¥ä¸‹åˆ†æ”¯ç­–ç•¥ï¼š

- **`dev` åˆ†æ”¯**ï¼šå¼€å‘åˆ†æ”¯ï¼Œæ‰€æœ‰æ–°åŠŸèƒ½å’Œä¿®å¤éƒ½åœ¨æ­¤åˆ†æ”¯å®Œæˆ
- **`main` åˆ†æ”¯**ï¼šç”Ÿäº§ç¯å¢ƒåˆ†æ”¯ï¼ŒåªåŒ…å«ç»è¿‡å……åˆ†æµ‹è¯•ã€ç”Ÿäº§å°±ç»ªçš„ä»£ç 

### åˆå¹¶åˆ° main åˆ†æ”¯çš„æµç¨‹

1. åœ¨ `dev` åˆ†æ”¯å®Œæˆå¼€å‘å’Œæµ‹è¯•
2. ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
3. è¿è¡Œ `yarn build` ç¡®ä¿æ„å»ºæˆåŠŸ
4. æ£€æŸ¥ä»£ç è´¨é‡ï¼ˆlintã€æµ‹è¯•ç­‰ï¼‰
5. åˆ›å»º Pull Request æˆ–ç›´æ¥åˆå¹¶åˆ° `main` åˆ†æ”¯
6. åœ¨ `main` åˆ†æ”¯è¿›è¡Œæœ€ç»ˆéªŒè¯åéƒ¨ç½²

**æ³¨æ„ï¼š** `main` åˆ†æ”¯å¿…é¡»ä¿æŒå¹²å‡€ï¼ŒåªåŒ…å«ç”Ÿäº§å°±ç»ªçš„ä»£ç ã€‚

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### 1. ç¯å¢ƒå˜é‡é…ç½®

- [ ] åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º `.env.production` æ–‡ä»¶ï¼ˆå‚è€ƒ `.env.production.example`ï¼‰
- [ ] é…ç½®ç”Ÿäº§ç¯å¢ƒ API åœ°å€ï¼š`VUE_APP_API_BASE_URL`
- [ ] ç¡®è®¤åç«¯æœåŠ¡å·²éƒ¨ç½²å¹¶æ­£å¸¸è¿è¡Œ
- [ ] æ£€æŸ¥ CORS é…ç½®ï¼Œç¡®ä¿åç«¯å…è®¸å‰ç«¯åŸŸåè®¿é—®
- [ ] **é‡è¦**ï¼š`.env.production` æ–‡ä»¶ä¸è¦æäº¤åˆ° gitï¼ˆå·²åœ¨ .gitignore ä¸­ï¼‰

### 2. ä»£ç æ£€æŸ¥

- [ ] ç§»é™¤æ‰€æœ‰ `console.log` è°ƒè¯•ä»£ç ï¼ˆæˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡æ§åˆ¶ï¼‰
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰ç¡¬ç¼–ç çš„å¼€å‘ç¯å¢ƒåœ°å€
- [ ] ç¡®è®¤æ‰€æœ‰ API è°ƒç”¨éƒ½ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®çš„åœ°å€
- [ ] æ£€æŸ¥é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„

### 3. æ„å»ºä¼˜åŒ–

- [ ] è¿è¡Œ `yarn build` æ£€æŸ¥æ„å»ºæ˜¯å¦æˆåŠŸ
- [ ] æ£€æŸ¥ `dist` ç›®å½•æ–‡ä»¶å¤§å°ï¼Œç¡®è®¤æ²¡æœ‰å¼‚å¸¸å¤§çš„æ–‡ä»¶
- [ ] ç¡®è®¤é™æ€èµ„æºè·¯å¾„æ­£ç¡®ï¼ˆç›¸å¯¹è·¯å¾„æˆ– CDNï¼‰
- [ ] æ£€æŸ¥ Source Map æ˜¯å¦éœ€è¦ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­ï¼‰

### 4. å®‰å…¨é…ç½®

- [ ] ç¡®è®¤ API å¯†é’¥ä¸ä¼šæš´éœ²åœ¨å‰ç«¯ä»£ç ä¸­
- [ ] æ£€æŸ¥æ•æ„Ÿä¿¡æ¯æ˜¯å¦ç¡¬ç¼–ç 
- [ ] ç¡®è®¤ HTTPS é…ç½®æ­£ç¡®
- [ ] æ£€æŸ¥ CSPï¼ˆContent Security Policyï¼‰é…ç½®

### 5. æ€§èƒ½ä¼˜åŒ–

- [ ] å¯ç”¨ Gzip å‹ç¼©
- [ ] é…ç½® CDN åŠ é€Ÿé™æ€èµ„æº
- [ ] æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å·²ä¼˜åŒ–
- [ ] ç¡®è®¤æ‡’åŠ è½½é…ç½®æ­£ç¡®

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹å¼ä¸€ï¼šè…¾è®¯äº‘å¼€å‘éƒ¨ç½²ï¼ˆæ¨èï¼‰

é¡¹ç›®å·²é…ç½® `cloudbaserc.json`ï¼Œå¯ä»¥ä½¿ç”¨è…¾è®¯äº‘å¼€å‘ CLI éƒ¨ç½²ï¼š

```bash
# 1. å®‰è£…äº‘å¼€å‘ CLI
npm install -g @cloudbase/cli

# 2. ç™»å½•
tcb login

# 3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåœ¨äº‘å¼€å‘æ§åˆ¶å°æˆ–ä½¿ç”¨ CLIï¼‰
# è®¾ç½® VUE_APP_API_BASE_URL ç­‰ç¯å¢ƒå˜é‡

# 4. éƒ¨ç½²
tcb framework deploy
```

### æ–¹å¼äºŒï¼šä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

#### 1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
yarn install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
yarn build
```

æ„å»ºå®Œæˆåï¼Œ`dist` ç›®å½•åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶ã€‚

#### 2. é…ç½® Web æœåŠ¡å™¨

**Nginx é…ç½®ç¤ºä¾‹ï¼š**

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # å¯ç”¨ Gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    gzip_min_length 1000;
    
    # é™æ€æ–‡ä»¶ç›®å½•
    root /path/to/your/dist;
    index index.html;
    
    # API ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
    location /api {
        proxy_pass https://your-backend-domain.com;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # å‰ç«¯è·¯ç”±æ”¯æŒï¼ˆVue Router history æ¨¡å¼ï¼‰
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

**Apache é…ç½®ç¤ºä¾‹ï¼š**

åœ¨ `dist` ç›®å½•åˆ›å»º `.htaccess` æ–‡ä»¶ï¼š

```apache
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteRule ^index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>

# å¯ç”¨ Gzip å‹ç¼©
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# é™æ€èµ„æºç¼“å­˜
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
</IfModule>
```

#### 3. ä¸Šä¼ æ–‡ä»¶

å°† `dist` ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚

#### 4. é…ç½® HTTPSï¼ˆæ¨èï¼‰

ä½¿ç”¨ Let's Encrypt å…è´¹ SSL è¯ä¹¦ï¼š

```bash
# å®‰è£… Certbot
sudo apt-get install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com
```

## ğŸ”§ æ„å»ºä¼˜åŒ–å»ºè®®

### 1. ä¿®æ”¹ vue.config.js æ·»åŠ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

```javascript
module.exports = {
  // ... ç°æœ‰é…ç½®
  
  // ç”Ÿäº§ç¯å¢ƒå…³é—­ Source Mapï¼ˆå‡å°æ–‡ä»¶å¤§å°ï¼Œæé«˜å®‰å…¨æ€§ï¼‰
  productionSourceMap: false,
  
  // æ„å»ºä¼˜åŒ–
  configureWebpack: {
    optimization: {
      splitChunks: {
        chunks: 'all',
        cacheGroups: {
          vendor: {
            name: 'chunk-vendors',
            test: /[\\/]node_modules[\\/]/,
            priority: 10,
            chunks: 'initial'
          },
          elementUI: {
            name: 'chunk-elementUI',
            priority: 20,
            test: /[\\/]node_modules[\\/]element-plus[\\/]/
          }
        }
      }
    }
  }
};
```

### 2. æ·»åŠ æ„å»ºè„šæœ¬

åœ¨ `package.json` ä¸­æ·»åŠ ï¼š

```json
{
  "scripts": {
    "build:prod": "vue-cli-service build --mode production",
    "build:analyze": "vue-cli-service build --report"
  }
}
```

## ğŸ“Š éƒ¨ç½²åéªŒè¯

### 1. åŠŸèƒ½æ£€æŸ¥

- [ ] é¦–é¡µåŠ è½½æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•/æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] API è¯·æ±‚æ­£å¸¸ï¼ˆæ£€æŸ¥ç½‘ç»œè¯·æ±‚ï¼‰
- [ ] è·¯ç”±è·³è½¬æ­£å¸¸ï¼ˆåˆ·æ–°é¡µé¢ä¸ 404ï¼‰
- [ ] é™æ€èµ„æºåŠ è½½æ­£å¸¸ï¼ˆå›¾ç‰‡ã€å­—ä½“ç­‰ï¼‰

### 2. æ€§èƒ½æ£€æŸ¥

- [ ] ä½¿ç”¨ Lighthouse æ£€æŸ¥æ€§èƒ½åˆ†æ•°ï¼ˆç›®æ ‡ï¼š90+ï¼‰
- [ ] æ£€æŸ¥é¦–å±åŠ è½½æ—¶é—´
- [ ] æ£€æŸ¥èµ„æºåŠ è½½æ—¶é—´
- [ ] æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### 3. å…¼å®¹æ€§æ£€æŸ¥

- [ ] Chrome/Edge æœ€æ–°ç‰ˆæœ¬
- [ ] Firefox æœ€æ–°ç‰ˆæœ¬
- [ ] Safari æœ€æ–°ç‰ˆæœ¬
- [ ] ç§»åŠ¨ç«¯æµè§ˆå™¨

## ğŸ› å¸¸è§é—®é¢˜

### 1. è·¯ç”±åˆ·æ–° 404

**åŸå› ï¼š** Web æœåŠ¡å™¨æœªé…ç½® history æ¨¡å¼æ”¯æŒ

**è§£å†³ï¼š** å‚è€ƒä¸Šé¢çš„ Nginx/Apache é…ç½®ï¼Œæ·»åŠ  `try_files` æˆ– `RewriteRule`

### 2. API è¯·æ±‚è·¨åŸŸé”™è¯¯

**åŸå› ï¼š** åç«¯æœªé…ç½® CORS æˆ–é…ç½®ä¸æ­£ç¡®

**è§£å†³ï¼š** åœ¨åç«¯é…ç½®å…è®¸å‰ç«¯åŸŸåçš„ CORS

### 3. é™æ€èµ„æº 404

**åŸå› ï¼š** èµ„æºè·¯å¾„é…ç½®é”™è¯¯

**è§£å†³ï¼š** æ£€æŸ¥ `vue.config.js` ä¸­çš„ `publicPath` é…ç½®

### 4. ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ

**åŸå› ï¼š** ç¯å¢ƒå˜é‡å¿…é¡»ä»¥ `VUE_APP_` å¼€å¤´

**è§£å†³ï¼š** ç¡®è®¤ç¯å¢ƒå˜é‡å‘½åæ­£ç¡®ï¼Œé‡æ–°æ„å»º

## ğŸ“ ç»´æŠ¤å»ºè®®

1. **å®šæœŸæ›´æ–°ä¾èµ–**ï¼š`yarn upgrade`
2. **ç›‘æ§é”™è¯¯**ï¼šé›†æˆé”™è¯¯ç›‘æ§æœåŠ¡ï¼ˆå¦‚ Sentryï¼‰
3. **æ€§èƒ½ç›‘æ§**ï¼šä½¿ç”¨ Google Analytics æˆ–ç±»ä¼¼å·¥å…·
4. **å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½æ„å»ºäº§ç‰©å’Œé…ç½®æ–‡ä»¶
5. **æ—¥å¿—**ï¼šé…ç½®è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—

## ğŸ” å®‰å…¨å»ºè®®

1. **HTTPS**ï¼šå¼ºåˆ¶ä½¿ç”¨ HTTPS
2. **CSP**ï¼šé…ç½®å†…å®¹å®‰å…¨ç­–ç•¥
3. **XSS é˜²æŠ¤**ï¼šç¡®ä¿æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡è½¬ä¹‰
4. **API å®‰å…¨**ï¼šä½¿ç”¨ Token è®¤è¯ï¼Œé¿å…åœ¨ URL ä¸­ä¼ é€’æ•æ„Ÿä¿¡æ¯
5. **ä¾èµ–å®‰å…¨**ï¼šå®šæœŸæ£€æŸ¥ä¾èµ–æ¼æ´ï¼ˆ`yarn audit`ï¼‰

